<form action="" method="post">
<div class="selection-input">
  
  <div class="divider"> </div>

  <div id="budget-input" class="pref-input">
    <div id="budget-text" class="pref-text">BUDGET</div>
    <div id="budget-input-inner" class="pref-inner">
      <div class="slider-control">
        <div class="amount-display">$<span id="budget-amountValue">100</span></div>

        <button id="budget-decreaseBtn">−</button>
            
        <input type="range" name="budget_slider" id="budget-amountSlider" min="0" max="10000" value="100" step="50">
            
        <button id="budget-increaseBtn">+</button>
      </div>
    </div>
  </div>

  <div class="divider"> </div>

  <div id="passport-input" class="pref-input">
    <div id="passport-text" class="pref-text">PASSPORTS</div>
    <div id="passport-input-inner" class="pref-selects">
      <div id="passport-tag-selector" class="tag-selector">
        <select id="passport-tagDropdown">
          <option value="" disabled selected>Select a tag</option>
          <button onclick="addTag()">Add</button>
        </select>

        <div id="passport-selectedTags" class="selectedTags"></div>
      </div>
      
    </div>
  </div>

  <div class="divider"> </div>

  <div id="visa-input" class="pref-input">
    <div id="visa-text" class="pref-text">VISAS</div>
    <div id="visa-input-inner" class="pref-selects">
      <div id="visa-tag-selector" class="tag-selector">
        <select id="visa-tagDropdown">
          <option value="" disabled selected>Select a tag</option>
          <button onclick="addTag()">Add</button>
        </select>

        <div id="visa-selectedTags" class="selectedTags"></div>
      </div>

    </div>
  </div>

  <div class="divider"> </div>  

  <div id="climate-input" class="pref-input">
    <div id="climate-text" class="pref-text">CLIMATE</div>
    <div id="climate-input-inner" class="pref-selects">
      <div id="climate-tag-selector" class="tag-selector">
        <select id="climate-tagDropdown">
          <option value="" disabled selected>Select a tag</option>
          <button onclick="addTag()">Add</button>
        </select>

        <div id="climate-selectedTags" class="selectedTags"></div>
      </div>      
      
      <div class="slider-control">
        <div ><span> Priority: </span></div>
        <div class="amount-display"> <span id="climate-amountValue">0</span></div>

        <button id="climate-decreaseBtn" class="decreaseBtn">−</button>
            
        <input type="range" name="climate_slider" id="climate-amountSlider" min="0" max="10" value="0" >
            
        <button id="climate-increaseBtn" class="increaseBtn">+</button>
      </div>
    </div>
  </div>

  <div class="divider"> </div>  

  <div id="land-input" class="pref-input">
    <div id="land-text" class="pref-text">LANDMARKS</div>
    <div id="land-input-inner" class="pref-selects">
      <div id="landmark-tag-selector" class="tag-selector">
        <select id="landmark-tagDropdown">
          <option value="" disabled selected>Select a tag</option>
          <button onclick="addTag()">Add</button>
        </select>

        <div id="landmark-selectedTags" class="selectedTags"></div>
      </div>
      
      <div class="slider-control">
        <div ><span> Priority: </span></div>
        <div class="amount-display"> <span id="landmark-amountValue">0</span></div>

        <button id="landmark-decreaseBtn" class="decreaseBtn">−</button>
            
        <input type="range" name="landmark_slider" id="landmark-amountSlider" min="0" max="10" value="0" >
            
        <button id="landmark-increaseBtn" class="increaseBtn">+</button>
      </div>
    </div>
  </div>
  
  <div class="divider"> </div>  

  <div id="outdoor-input" class="pref-input">
    <div id="outdoor-text" class="pref-text">OUTDOOR EXPERIENCES</div>
    <div id="outdoor-input-inner" class="pref-selects">
      <div id="outdoor-tag-selector" class="tag-selector">
        <select id="outdoor-tagDropdown">
          <option value="" disabled selected>Select a tag</option>
          <button onclick="addTag()">Add</button>
        </select>

        <div id="outdoor-selectedTags" class="selectedTags"></div>
      </div>
      
      <div class="slider-control">
        <div ><span> Priority: </span></div>
        <div class="amount-display"> <span id="outdoor-amountValue">0</span></div>

        <button id="outdoor-decreaseBtn" class="decreaseBtn">−</button>
            
        <input type="range" name="outdoor_slider" id="outdoor-amountSlider" min="0" max="10" value="0" >
            
        <button id="outdoor-increaseBtn" class="increaseBtn">+</button>
      </div>
    </div>
  </div>

  <div class="divider"> </div>  

  <div id="food-input" class="pref-input">
    <div id="food-text" class="pref-text">FOOD & CULINARY</div>
    <div id="food-input-inner" class="pref-selects">
      <div id="food-tag-selector" class="tag-selector">
        <select id="food-tagDropdown">
          <option value="" disabled selected>Select a tag</option>
          <button onclick="addTag()">Add</button>
        </select>

        <div id="food-selectedTags" class="selectedTags"></div>
      </div>
      
      <div class="slider-control">
        <div ><span> Priority: </span></div>
        <div class="amount-display"> <span id="food-amountValue">0</span></div>

        <button id="food-decreaseBtn" class="decreaseBtn">−</button>
            
        <input type="range" name="food_slider" id="food-amountSlider" min="0" max="10" value="0" >
            
        <button id="food-increaseBtn" class="increaseBtn">+</button>
      </div>
    </div>
  </div>

  <div class="divider"> </div>  

  <div id="entertainment-input" class="pref-input">
    <div id="entertainment-text" class="pref-text">ENTERTAINMENT</div>
    <div id="entertainment-input-inner" class="pref-selects">
      <div id="entertainment-tag-selector" class="tag-selector">
        <select id="entertainment-tagDropdown">
          <option value="" disabled selected>Select a tag</option>
          <button onclick="addTag()">Add</button>
        </select>

        <div id="entertainment-selectedTags" class="selectedTags"></div>
      </div>
      
      <div class="slider-control">
        <div ><span> Priority: </span></div>
        <div class="amount-display"> <span id="entertainment-amountValue">0</span></div>

        <button id="entertainment-decreaseBtn" class="decreaseBtn">−</button>
            
        <input type="range" name="entertainment_slider" id="entertainment-amountSlider" min="0" max="10" value="0" >
            
        <button id="entertainment-increaseBtn" class="increaseBtn">+</button>
      </div>
    </div>
  </div>

  <div class="divider"> </div>  

  <div id="relax-input" class="pref-input">
    <div id="relax-text" class="pref-text">RELAXATION & WELLNESS</div>
    <div id="relax-input-inner" class="pref-selects">
      <div id="relax-tag-selector" class="tag-selector">
        <select id="relax-tagDropdown">
          <option value="" disabled selected>Select a tag</option>
          <button onclick="addTag()">Add</button>
        </select>

        <div id="relax-selectedTags" class="selectedTags"></div>
      </div>
      
      <div class="slider-control">
        <div ><span> Priority: </span></div>
        <div class="amount-display"> <span id="relax-amountValue">0</span></div>

        <button id="relax-decreaseBtn"class="decreaseBtn">−</button>
            
        <input type="range" name="relaxation_slider" id="relax-amountSlider" min="0" max="10" value="0" >
            
        <button id="relax-increaseBtn" class="increaseBtn">+</button>
      </div>
    </div>
  </div>

  <div class="divider"> </div>  
  
 
  <div id="save-input" class="pref-input">
    <div id="save-input-inner" class="pref-inner">
      <button type = "submit" class="save">Save Changes</button>    
    </div>   

  </div>
  

</div>
</form>


{% block js %}   
  <script>

    //Countries for Visa & Passport Dropdowns
    const countries = [
      "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda",
      "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas",
      "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize",
      "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil",
      "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia",
      "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China",
      "Colombia", "Comoros", "Congo (Congo-Brazzaville)", "Congo (Congo-Kinshasa)", 
      "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czechia", "Denmark", "Djibouti",
      "Dominica", "Dominican Republic", "Ecuador", "Egypt", "El Salvador",
      "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji",
      "Finland", "France", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece",
      "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti",
      "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq",
      "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan",
      "Kenya", "Kiribati", "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon",
      "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg",
      "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta",
      "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia",
      "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique",
      "Myanmar (Burma)", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand",
      "Nicaragua", "Niger", "Nigeria", "North Korea", "North Macedonia", "Norway",
      "Oman", "Pakistan", "Palau", "Panama", "Papua New Guinea", "Paraguay", "Peru",
      "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda",
      "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines",
      "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal",
      "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia",
      "Solomon Islands", "Somalia", "South Africa", "South Korea", "South Sudan",
      "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria",
      "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Timor-Leste", "Togo", "Tonga",
      "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu", "Uganda",
      "Ukraine", "United Arab Emirates", "United Kingdom", "United States of America",
      "Uruguay", "Uzbekistan", "Vanuatu", "Vatican City", "Venezuela", "Vietnam",
      "Yemen", "Zambia", "Zimbabwe"
    ];

    //Preferences Tags for Dropdowns
    const climate = ["Tropical", "Dry", "Temperate", "Polar"];

    const landmarks = ["Monuments", "Museums", "Galleries", "Festivals"];

    const outdoor = ["Snowboarding", "Rafting", "Water Sports", "Nature Exploration"];

    const food = ["Restaurants", "Markets", "Street Food", "Local Cuisine"];

    const entertainment = ["Concerts", "Theater", "Bars", "Clubs"];

    const relaxation = ["Beaches", "Spas", "Springs", "Yoga"];



    //Dropdown Elements
    const dropdown_elements = [
      {
        /*Visa*/
        elementName: "Visa",
        dropdown: document.getElementById('visa-tagDropdown'),
        selectedTagsContainer: document.getElementById('visa-selectedTags')
      },
      {
        /*Passport*/
        elementName: "Passport",
        dropdown: document.getElementById('passport-tagDropdown'),
        selectedTagsContainer: document.getElementById('passport-selectedTags')
      },
      {
        /*Climate*/
        elementName: "Climate",
        dropdown: document.getElementById('climate-tagDropdown'),
        selectedTagsContainer: document.getElementById('climate-selectedTags')
      },
      {
        /*Landmark*/
        elementName: "Landmark",
        dropdown: document.getElementById('landmark-tagDropdown'),
        selectedTagsContainer: document.getElementById('landmark-selectedTags')
      },
      {
        /*Outdoor Activities*/
        elementName: "Outdoor Activities",
        dropdown: document.getElementById('outdoor-tagDropdown'),
        selectedTagsContainer: document.getElementById('outdoor-selectedTags')
      },
      {
        /*Food & Culinary*/
        elementName: "Food & Culinary",
        dropdown: document.getElementById('food-tagDropdown'),
        selectedTagsContainer: document.getElementById('food-selectedTags')
      },
      {
        /*Entertainment*/
        elementName: "Entertainment",
        dropdown: document.getElementById('entertainment-tagDropdown'),
        selectedTagsContainer: document.getElementById('entertainment-selectedTags')
      },
      {
        /*Relaxation & Wellness*/
        elementName: "Relaxation & Wellness",
        dropdown: document.getElementById('relax-tagDropdown'),
        selectedTagsContainer: document.getElementById('relax-selectedTags')
      }
    ];
    


    //Sliders  
    const slider_elements = [
      {
        /*Budget*/
        elementName: "Budget",
        slider: document.getElementById("budget-amountSlider"),
        amountValue: document.getElementById("budget-amountValue"),
        increaseBtn: document.getElementById("budget-increaseBtn"),
        decreaseBtn: document.getElementById("budget-decreaseBtn"),
        stepValue: 50
      },
      {
        /*Climate*/
        elementName: "Climate",
        slider: document.getElementById("climate-amountSlider"),
        amountValue: document.getElementById("climate-amountValue"),
        increaseBtn: document.getElementById("climate-increaseBtn"),
        decreaseBtn: document.getElementById("climate-decreaseBtn"),
        stepValue: 1 
      },
      {
        /*Landmarks*/
        elementName: "Landmarks",
        slider: document.getElementById("landmark-amountSlider"),
        amountValue: document.getElementById("landmark-amountValue"),
        increaseBtn: document.getElementById("landmark-increaseBtn"),
        decreaseBtn: document.getElementById("landmark-decreaseBtn"),
        stepValue: 1
      },
      {
        /*Outdoor Activities*/
        elementName: "Outdoor Activities",
        slider: document.getElementById("outdoor-amountSlider"),
        amountValue: document.getElementById("outdoor-amountValue"),
        increaseBtn: document.getElementById("outdoor-increaseBtn"),
        decreaseBtn: document.getElementById("outdoor-decreaseBtn"),
      },
      {
        /*Food & Culinary*/
        elementName: "Food Culinary",
        slider: document.getElementById("food-amountSlider"),
        amountValue: document.getElementById("food-amountValue"),
        increaseBtn: document.getElementById("food-increaseBtn"),
        decreaseBtn: document.getElementById("food-decreaseBtn"),
        stepValue: 1
      },
      {
            /*Entertainment*/
        elementName: "Entertainment",
        slider: document.getElementById("entertainment-amountSlider"),
        amountValue: document.getElementById("entertainment-amountValue"),
        increaseBtn: document.getElementById("entertainment-increaseBtn"),
        decreaseBtn: document.getElementById("entertainment-decreaseBtn"),
        stepValue: 1
      },
      {
        /*Relaxation & Wellness*/
        elementName: "Relaxation & Wellness",
        slider: document.getElementById("relax-amountSlider"),
        amountValue: document.getElementById("relax-amountValue"),
        increaseBtn: document.getElementById("relax-increaseBtn"),
        decreaseBtn: document.getElementById("relax-decreaseBtn"),
        stepValue: 1
      }
    ];


    // Populate the Dropdowns
    countries.forEach(country => {
      const option1 = document.createElement("option");
      const option2 = document.createElement("option");

      option2.value = country;
      option2.text = country;
      option1.value = country;
      option1.text = country;

      const visa_dropdown_obj = dropdown_elements.find(el => el.elementName === "Visa");
      visa_dropdown_obj.dropdown.appendChild(option1);

      const passport_dropdown_obj = dropdown_elements.find(el => el.elementName === "Passport");
      passport_dropdown_obj.dropdown.appendChild(option2);
    });

    const tag_lists = [
      climate, landmarks, outdoor, food, entertainment, relaxation
    ]
    const dropdown_names = [
      "Climate", "Landmark", "Outdoor Activities", "Food & Culinary", "Entertainment",
      "Relaxation & Wellness"
    ] 
    let name_tracker = 0
    
    tag_lists.forEach(list => {
      
      list.forEach(tag => {
        const option = document.createElement("option");

        option.value = tag;
        option.text = tag;

        const dropdown_obj = dropdown_elements.find(el => el.elementName === dropdown_names[name_tracker]);
        dropdown_obj.dropdown.appendChild(option);
      });
      
      name_tracker += 1;

    });
    

    function populate_tags(el_dropdown, tags_container) {      
      const value = el_dropdown.value;
      if (!value) return;

      // Check for duplicates
      if (Array.from(tags_container.children).some(tag => tag.dataset.value === value)) return;

      const tag = document.createElement('div');
      tag.classList.add('selection-tag');
      tag.dataset.value = value;
      tag.innerHTML = `${value} <span class="remove-tag">&times;</span>`;

      tags_container.appendChild(tag);
    }
    
    function remove_tags(e) {      
      if (e.target.classList.contains('remove-tag')) {
        e.target.parentElement.remove();
      }
    }

    dropdown_elements.forEach(element => {

      element.dropdown.addEventListener('change', () => {
        populate_tags(element.dropdown, element.selectedTagsContainer);
      });

      element.selectedTagsContainer.addEventListener('click', (e) => {
        remove_tags(e);
      });

    });

    

    // Update value when slider moves (within its range)
    function set_pref_amt(el_slider, amt_val, display_val) {      
      display_val = parseInt(el_slider.value);
      amt_val.innerText = display_val;
    }

    // Increase displayed amount
    function increase_amt(el_slider, amt_val, add_val) { 
      let current_val = parseInt(amt_val.innerText);

      if (current_val < parseInt(el_slider.max)) {
        current_val += add_val;
      }

      el_slider.value = current_val;
      amt_val.innerText = current_val;
    }

    // Decrease displayed amount
    function decrease_amt(el_slider, amt_val, minus_val) { 
      let current_val = parseInt(amt_val.innerText);

      if (current_val > parseInt(el_slider.min)) {
        current_val -= minus_val;
      }

      el_slider.value = current_val;
      amt_val.innerText = current_val;
    }

    //Slider & Amount Adjustment
    slider_elements.forEach(element => {

      element.slider.addEventListener("input", () => {
        set_pref_amt(element.slider, element.amountValue);
      });

      element.increaseBtn.addEventListener("click", () => {
        increase_amt(element.slider, element.amountValue, element.stepValue)
      });
      
     element.decreaseBtn.addEventListener("click", () => {
        decrease_amt(element.slider, element.amountValue, element.stepValue)
      });

    });

  </script>

{% endblock%}